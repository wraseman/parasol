<!doctype html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
</head>

<title>Example 3</title>

<!-- TODO: update with combined css: parasol.css -->
<link rel="stylesheet" type="text/css" href="./parcoords.css">
<link rel="stylesheet" type="text/css" href="style.css">

<!-- include slickgrid stylesheets -->
<link rel="stylesheet" href="./lib/slickgrid/slick.grid.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="./lib/slickgrid/jquery-ui-1.8.16.custom.css" type="text/css" />
<link rel="stylesheet" href="./lib/slickgrid/plugins/slick.columnpicker.css" type="text/css"/>

<script src="./lib/d3.v5.min.js"></script>
<script src="./parasol.standalone.js"></script>

<body>
<h1> Weighted scoring of features </h1>
<p>
  <form>
    Fuel Economy - weight: <br> <input type="range" min="0" max="10" id="econ_weight"> <br>
    # of Cylinders - weight: <br> <input type="range" min="0" max="10" id="cyl_weight"> <br>
    Displacement - weight: <br> <input type="range" min="0" max="10" id="displ_weight"> <br>
    Horsepower - weight: <br> <input type="range" min="0" max="10" id="power_weight"> <br>
  </form>
  <br> <button id="apply_weights"> <b> Apply Weights </b> </button>
</p>

<div id="plot01" class="parcoords" style="height:300px; width:800px;"></div>
<div id="grid" style="width:100%;height:500px;" class="slickgrid-container"></div>
</body>

<script>
// read in data and create visualization
d3.csv('data/cars_no-name.csv').then(function(data) {

  // create Parasol object, add grid, link, and perform clustering
  var ps = Parasol(data)('.parcoords')
            .attachGrid({container: '#grid'})
            .linked()
            // .hideAxes(['economy (mpg)'])
            // .hideAxes(['cylinders'])
            // .hideAxes(['displacement (cc)'])
            // .hideAxes(['power (hp)'])
            .hideAxes(['weight (lb)'])
            .hideAxes(['0-60 mph (s)'])
            // .hideAxes(['year'])

  ps = update_and_render(ps);

  // activate button
  d3.select('#apply_weights').on('click', function() {
    // setup weights (unspecified vars given weight = 0)
    var weights = {
      'economy (mpg)': document.getElementById('econ_weight').value,
      'cylinders': document.getElementById('cyl_weight').value,
      'displacement (cc)': document.getElementById('displ_weight').value,
      'power (hp)': document.getElementById('power_weight').value
    };

    // console.log(document.getElementById('econ_weight').value);

    ps.aggregateScores({ weights: weights });
    update_and_render(ps)
  });
});

function update_and_render(ps) {
  // apply Parcoords API to update and render plots
  ps.charts.forEach(
    (pc) => {
        pc.alpha(0.1)  // change transparency
        .reorderable()  // make axes dynamically reorderable
        .render()
        .updateAxes(0);
    }
  )
  return ps;
}

</script>
